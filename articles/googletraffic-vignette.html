<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="googletraffic">
<title>Google Traffic • googletraffic</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Google Traffic">
<meta property="og:description" content="googletraffic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">googletraffic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/googletraffic-vignette.html">Google Traffic</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Google Traffic</h1>
                        <h4 data-toc-skip class="author">Rob Marty</h4>
            
            <h4 data-toc-skip class="date">2022-09-09</h4>
      
      
      <div class="d-none name"><code>googletraffic-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, we load packages, set the Google API key, and define a palette
used for visualizing traffic data in leaflet.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load Google Traffic package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dime-worldbank.github.io/googletraffic/" class="external-link">googletraffic</a></span><span class="op">)</span></span>
<span><span class="co">## Load packages for working with and visualizing data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bhaskarvk/leaflet.extras" class="external-link">leaflet.extras</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/leaflet.providers" class="external-link">leaflet.providers</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">## Set Google API Key</span></span>
<span><span class="va">google_key</span> <span class="op">&lt;-</span> <span class="st">"GOOGLE-API-KEY-HERE"</span></span>
<span><span class="co">## Leaflet Palette</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"#660000"</span><span class="op">)</span>, </span>
<span>                    <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>                    na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="key-parameters">Key parameters <a name="key-parameters"></a><a class="anchor" aria-label="anchor" href="#key-parameters"></a>
</h2>
<p>The following are key parameters used when querying Google Traffic
data.</p>
<ul>
<li>
<strong>zoom:</strong> The <a href="https://wiki.openstreetmap.org/wiki/Zoom_levels" class="external-link">zoom level</a>
defines the resolution of the traffic image. Values can range from 0 to
20. At the equator, with a zoom level 10, each pixel will be about 150
meters; with a zoom level 20, each pixel will be about 0.15 meters.
Consequently, smaller zoom levels can be used if only larger roads are
of interest (e.g., highways), while larger zoom levels will be needed
for capturing smaller roads.</li>
<li>
<strong>height/width:</strong> The <code>height</code> and
<code>width</code> parameters define the height and width of the raster
in terms of pixels. The kilometer height/width of pixels depends
primarily on the <code>zoom</code> level (larger <code>zoom</code>
levels correspond to the <code>height</code> and <code>width</code>
having a smaller kilometer distance). Google traffic data takes time to
render on a map, and larger <code>height</code> and <code>width</code>
values require more time needed for data to render. The functions
automatically scale the delay time depending on the <code>height</code>
and <code>width</code> values set, but the delay time can also be
manually set using the <code>webshot_delay</code> parameter. Note that
traffic data may fail to render for very large <code>height</code> and
<code>width</code> values, no matter the <code>webshot_delay</code>
set.</li>
</ul>
</div>
<div class="section level2">
<h2 id="raster-around-point">Raster Around Point<a class="anchor" aria-label="anchor" href="#raster-around-point"></a>
</h2>
<p>The <code><a href="../reference/gt_make_raster.html">gt_make_raster()</a></code> function produces a raster, using a
centroid location and a height/width around the centroid to specify the
location to query traffic information. The below example queries traffic
for lower Manhattan, NYC.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_raster.html">gt_make_raster</a></span><span class="op">(</span>location   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.712778</span>, <span class="op">-</span><span class="fl">74.006111</span><span class="op">)</span>,</span>
<span>                    height     <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    width      <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    zoom       <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                    google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>By using a smaller <code>zoom</code>, we can capture a larger area;
however, the pixels are more coarse.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_raster.html">gt_make_raster</a></span><span class="op">(</span>location   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.384900</span>, <span class="op">-</span><span class="fl">78.891302</span><span class="op">)</span>,</span>
<span>                    height     <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    width      <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    zoom       <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                    google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="raster-around-polygon">Raster Around Polygon<a class="anchor" aria-label="anchor" href="#raster-around-polygon"></a>
</h2>
<p>The above example showed querying traffic information for lower
Manhattan. Here, we show querying traffic information for all of
Manhattan while still using a relatively high zoom level (that allows
capturing traffic on smaller streets). The
<code><a href="../reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> accepts a polygon as an
input; if needed, multiple API queries are made to query traffic for the
full polygon. We still specify the <code>height</code> and
<code>width</code>, which determines the height and width used for a
single API query. Large <code>height</code> and <code>width</code>
values will result in fewer Google queries, while smaller
<code>height</code> and <code>width</code> values will require more
queries to cover the same spatial area; traffic data will fail to render
if too large of <code>height</code> and <code>width</code> values are
set.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Grab polygon of Manhattan</span></span>
<span><span class="va">us_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html" class="external-link">getData</a></span><span class="op">(</span><span class="st">'GADM'</span>, country<span class="op">=</span><span class="st">'USA'</span>, level<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ny_sp</span> <span class="op">&lt;-</span> <span class="va">us_sp</span><span class="op">[</span><span class="va">us_sp</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"New York"</span>,<span class="op">]</span></span>
<span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon</a></span><span class="op">(</span>polygon    <span class="op">=</span> <span class="va">ny_sp</span>,</span>
<span>                                 height     <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                 width      <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                 zoom       <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                 google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="raster-using-grid">Raster Using Grid<a class="anchor" aria-label="anchor" href="#raster-using-grid"></a>
</h2>
<p><code><a href="../reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> creates a grid that covers
a polygon, creates a traffic raster for each grid, and merges the
rasters together. Some may prefer to first create and see the grid, then
create a traffic raster using this grid. For example, one could (1)
create a grid that covers a polygon then (2) remove certain grid tiles
that cover areas that may not be of interest. The
<code><a href="../reference/gt_make_grid.html">gt_make_grid()</a></code> and <code><a href="../reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code>
functions facilitate this process; <code><a href="../reference/gt_make_grid.html">gt_make_grid()</a></code> creates a
grid, then <code><a href="../reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code> uses a grid as an
input to create a traffic raster.</p>
<p>First, we create a grid using <code><a href="../reference/gt_make_grid.html">gt_make_grid()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_grid.html">gt_make_grid</a></span><span class="op">(</span>polygon <span class="op">=</span> <span class="va">ny_sp</span>,</span>
<span>                        height  <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        width   <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        zoom    <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_df</span>, popup <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We notice that the tile in the bottom left corner just covers water
and some land outside of Manhattan. To reduce the number of API queries
we need to make, we can remove this tile.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_clean_df</span> <span class="op">&lt;-</span> <span class="va">grid_df</span><span class="op">[</span><span class="op">-</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_clean_df</span><span class="op">)</span></span></code></pre></div>
<p>Second, we use the grid to make a traffic raster using
<code><a href="../reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid</a></span><span class="op">(</span>grid_param_df <span class="op">=</span> <span class="va">grid_clean_df</span>,</span>
<span>                              google_key    <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="make-png-then-convert-to-raster">Make PNG then Convert to Raster<a class="anchor" aria-label="anchor" href="#make-png-then-convert-to-raster"></a>
</h2>
<p>To make a google traffic raster, the functions first makes a
temporary png file then converts the png file to a raster—where only the
raster is outputted. Some workflows may require separating the
processes. For example, if querying Google traffic data on a regular
basis on a server, a user with a small server may want to minimize the
processes done on the server. Here, a user could create and save PNG
files on a server, then download the PNG files and convert the PNGs to a
raster locally.</p>
<p>To support these workflows, the package provides the: *
<strong><code><a href="../reference/gt_make_png.html">gt_make_png()</a></code></strong> function which creates a PNG
file with traffic data *
<strong><code><a href="../reference/gt_load_png_as_traffic_raster.html">gt_load_png_as_traffic_raster()</a></code></strong> function
which converts a PNG file into a spatially-referenced traffic raster</p>
<p>The below example illutrates the process.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Make png</span></span>
<span><span class="co"># The function does not output anything in R; it saves a png file, specified </span></span>
<span><span class="co"># using the "out_filename" parameter</span></span>
<span><span class="fu"><a href="../reference/gt_make_png.html">gt_make_png</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.712778</span>, <span class="op">-</span><span class="fl">74.006111</span><span class="op">)</span>,</span>
<span>            height   <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            width    <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            zoom     <span class="op">=</span> <span class="fl">16</span>,</span>
<span>            out_filename <span class="op">=</span> <span class="st">"google_traffic.png"</span>,</span>
<span>            google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span><span class="co">#### Convert png to raster</span></span>
<span><span class="co"># We now convert the "google_traffic.png" created above into a raster. Because </span></span>
<span><span class="co"># the png is not spatially referenced, we need to enter the same</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_load_png_as_traffic_raster.html">gt_load_png_as_traffic_raster</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"google_traffic.png"</span>,</span>
<span>                                   location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.712778</span>, <span class="op">-</span><span class="fl">74.006111</span><span class="op">)</span>,</span>
<span>                                   height   <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                   width    <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                   zoom     <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p>We can also use this process when querying traffic data for a larger
study area that requires making multiple API calls. The below example
illustrates creating multiple pngs from a grid.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Make grid</span></span>
<span><span class="co"># We first make a grid, which contains all the parameters needed to make a png then</span></span>
<span><span class="co"># the raster</span></span>
<span><span class="va">grid_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_make_grid.html">gt_make_grid</a></span><span class="op">(</span>polygon <span class="op">=</span> <span class="va">ny_sp</span>,</span>
<span>                        height  <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        width   <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        zoom    <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">grid_df</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Make PNGs from grid</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Exports PNGs</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid_df)){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  grid_i_df <span class="ot">&lt;-</span> grid_df[i,]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_make_png</span>(<span class="at">location     =</span> <span class="fu">c</span>(grid_i_df<span class="sc">$</span>latitude, grid_i_df<span class="sc">$</span>longitude),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">height       =</span> grid_i_df<span class="sc">$</span>height,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">width        =</span> grid_i_df<span class="sc">$</span>width,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">zoom         =</span> grid_i_df<span class="sc">$</span>zoom,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">out_filename =</span> <span class="fu">paste0</span>(i, <span class="st">"_google_traffic.png"</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">google_key   =</span> google_key)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">#### Convert PNGs to rasters</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we make a list of rasters</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>r_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span> <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid_df)){</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  grid_i_df <span class="ot">&lt;-</span> grid_df[i,]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_load_png_as_traffic_raster</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(i, <span class="st">"_google_traffic.png"</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">location =</span> <span class="fu">c</span>(grid_i_df<span class="sc">$</span>latitude, grid_i_df<span class="sc">$</span>longitude),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                <span class="at">height   =</span> grid_i_df<span class="sc">$</span>height,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                                <span class="at">width    =</span> grid_i_df<span class="sc">$</span>width,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">zoom     =</span> grid_i_df<span class="sc">$</span>zoom)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="do">#### Mosaic rasters together</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># To mosaic the rasters together, the mosaic() function from the raster package </span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># requires that rasters have the same origin and resolution. The above rasters will</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># not have the same orgin, and the resolutions will be slightly different. The </span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># gt_mosaic() function allows mosaicing rasters with different origins and resolutions.</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">gt_mosaic</span>(r_list)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Marty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
