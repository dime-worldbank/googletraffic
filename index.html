<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="What the package does (one paragraph).">
<title>What the Package Does (One Line, Title Case) â€¢ googletraffic</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta property="og:description" content="What the package does (one paragraph).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">googletraffic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/googletraffic-vignette.html">Google Traffic</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="googletraffic-">googletraffic <img src="images/hex.png" align="right" width="200"><a class="anchor" aria-label="anchor" href="#googletraffic-"></a>
</h1></div>
<p>Create traffic data from the <a href="https://developers.google.com/maps/documentation/javascript/trafficlayer" class="external-link">Google Maps Javascript API</a> Traffic Layer</p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#google-api-key">Google API Key</a></li>
<li><a href="#quickstart">Quickstart</a></li>
</ul>
</div>
<div class="section level1">
<h1 id="overview-">Overview <a name="overview"></a>
<a class="anchor" aria-label="anchor" href="#overview-"></a>
</h1>
<p>Google Maps provides information about traffic conditions across an area. This package provides functions to produce georeferenced rasters from live Google Maps traffic information. Providing Google traffic information in a georeferenced data format facilitates analysis of traffic information (e.g., spatially merging traffic information with other data sources, observing trends over time, etc).</p>
<p>The below image shows an example raster produced using the package showing <a href="https://www.google.com/maps/@38.9065495,-77.0368202,16z/data=!5m1!1e1" class="external-link">traffic within Washington, DC.</a></p>
<p align="center">
<img src="images/top_example.jpg" alt="Example" width="500"></p>
<p>Pixel values in rasters are derived from Google <a href="https://support.google.com/maps/answer/3092439?hl=en&amp;co=GENIE.Platform%3DDesktop#zippy=%2Ctraffic" class="external-link">traffic colors</a> can be one of four values:</p>
<table class="table">
<thead><tr class="header">
<th>Google Traffic Color</th>
<th>Description</th>
<th>Raster Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Green</td>
<td>No traffic delays</td>
<td>1</td>
</tr>
<tr class="even">
<td>Orange</td>
<td>Medium traffic</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Red</td>
<td>High traffic</td>
<td>3</td>
</tr>
<tr class="even">
<td>Dark Red</td>
<td>Heavy traffic</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="installation-">Installation <a name="installation"></a>
<a class="anchor" aria-label="anchor" href="#installation-"></a>
</h1>
<p>The package is available via github and can be installed using <code>devtools</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"dime-worldbank/googletraffic"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="google-api-key-">Google API Key <a name="google-api-key"></a>
<a class="anchor" aria-label="anchor" href="#google-api-key-"></a>
</h1>
<p>Querying Google traffic information requires a Google API key with the <a href="https://developers.google.com/maps/documentation/javascript/overview" class="external-link">Maps Javascript API</a> enabled. To create a Google API key, <a href="https://developers.google.com/maps/get-started#create-project" class="external-link">follow these instructions</a>.</p>
</div>
<div class="section level1">
<h1 id="quickstart-">Quickstart <a name="quickstart"></a>
<a class="anchor" aria-label="anchor" href="#quickstart-"></a>
</h1>
<p>The package enables querying Google traffic information around a specific location and for larger spatial extents. In this section, key parameters relevant across functions are defined; then examples are shown querying traffic around a point, polygon, and grid.</p>
<ul>
<li><a href="#key-parameters">Key parameters</a></li>
<li><a href="#raster-from-location">Query Traffic Around a Specific Location: <code>gt_make_raster()</code></a></li>
<li>
<a href="#large-extent">Query Granular Traffic Information for Large Spatial Extent</a>
<ul>
<li><a href="#raster-from-polygon">Query Traffic From a Polygon: <code>gt_make_raster_from_polygon()</code></a></li>
<li><a href="#raster-from-grid">Query Traffic From a Grid: <code>gt_make_raster_from_grid()</code></a></li>
</ul>
</li>
</ul>
<p>To run the below examples, the following code should be run first.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load Google Traffic package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dime-worldbank.github.io/googletraffic/" class="external-link">googletraffic</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load packages for visualizing data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bhaskarvk/leaflet.extras" class="external-link">leaflet.extras</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/leaflet.providers" class="external-link">leaflet.providers</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set Google API Key</span></span>
<span><span class="va">google_key</span> <span class="op">&lt;-</span> <span class="st">"GOOGLE-API-KEY-HERE"</span></span></code></pre></div>
<div class="section level2">
<h2 id="key-parameters-">Key parameters <a name="key-parameters"></a>
<a class="anchor" aria-label="anchor" href="#key-parameters-"></a>
</h2>
<p>The following are key parameters used when querying Google Traffic data.</p>
<ul>
<li><p><strong>zoom:</strong> The <a href="https://wiki.openstreetmap.org/wiki/Zoom_levels" class="external-link">zoom level</a> defines the resolution of the traffic image. Values can range from 0 to 20. At the equator, with a zoom level 10, each pixel will be about 150 meters; with a zoom level 20, each pixel will be about 0.15 meters. Consequently, smaller zoom levels can be used if only larger roads are of interest (e.g., highways), while larger zoom levels will be needed for capturing smaller roads.</p></li>
<li>
<p><strong>height/width:</strong> The <code>height</code> and <code>width</code> parameters define the height and width of the raster in terms of pixels. The kilometer height/width of pixels depends primarily on the <code>zoom</code> level (larger <code>zoom</code> levels correspond to the <code>height</code> and <code>width</code> having a smaller kilometer distance).</p>
<p><strong>Large height/width and delay time:</strong> Google traffic data takes time to render on a map, and larger <code>height</code> and <code>width</code> values require more time needed for data to render. The functions automatically scale the delay time depending on the <code>height</code> and <code>width</code> values set, but the delay time can also be manually set using the <code>webshot_delay</code> parameter. Note that traffic data may fail to render for very large <code>height</code> and <code>width</code> values, no matter the <code>webshot_delay</code> set (we find that the function works well with a <code>height</code>/<code>width</code> of 2000 or less).</p>
</li>
</ul>
<!---
* __webshot_delay:__ Google maps information is originally rendered on an interactive map. For large values of `height` and `width`, traffic information can take some time to render on a map. Consequently, a delay (specified using `webshot_delay`) is introduced to ensure traffic information is fully rendered on the map before traffic data is extracted. For example, when using a `height` and `width` of 500, a delay time of 2 seconds works well. For a `height` and `width` of 5000, a delay of up to 20 seconds may be needed. Traffic information cannot be rendered for very large `height` and `width` values, no matter the `webshot_delay` specified.
  - __Note that `webshot_delay` does not need to be specified.__ If it is not specified, the function estimates an appropriate delay length given the `height` and `width`. However, `webshot_delay` can be manually specified to (1) attempt to make faster queries or (2) or introduce longer delays if traffic information fails to render.
--->
</div>
<div class="section level2">
<h2 id="raster-around-a-specific-location-">Raster Around a Specific Location <a name="raster-from-location"></a>
<a class="anchor" aria-label="anchor" href="#raster-around-a-specific-location-"></a>
</h2>
<p>The <code><a href="reference/gt_make_raster.html">gt_make_raster()</a></code> function produces a raster, using a centroid location and a height/width around the centroid to specify the location to query traffic information. The below example queries traffic for lower Manhattan, NYC.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gt_make_raster.html">gt_make_raster</a></span><span class="op">(</span>location   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.712778</span>, <span class="op">-</span><span class="fl">74.006111</span><span class="op">)</span>,</span>
<span>                    height     <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    width      <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    zoom       <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                    google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"#660000"</span><span class="op">)</span>, <span class="fu">values</span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,</span>
<span>                        na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/nyc_small.jpg" alt="Example" width="500"></p>
<p>By using a smaller <code>zoom</code>, we can capture a larger area; however, the pixels are more coarse.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gt_make_raster.html">gt_make_raster</a></span><span class="op">(</span>location   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.384900</span>, <span class="op">-</span><span class="fl">78.891302</span><span class="op">)</span>,</span>
<span>                    height     <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    width      <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    zoom       <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                    google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Map raster</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"#660000"</span><span class="op">)</span>, <span class="fu">values</span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,</span>
<span>                        na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html" class="external-link">addRasterImage</a></span><span class="op">(</span><span class="va">r</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/usa.jpg" alt="Example" width="500"></p>
</div>
<div class="section level2">
<h2 id="query-granular-traffic-information-for-large-spatial-extent-">Query Granular Traffic Information for Large Spatial Extent <a name="large-extent"></a>
<a class="anchor" aria-label="anchor" href="#query-granular-traffic-information-for-large-spatial-extent-"></a>
</h2>
<p><strong>The above example illustrates a trade off between resolution and spatial extent.</strong> For small <code>zoom</code> levels, we can capture large areas, but the pixels values are also large â€” so we may only be able to detect overall traffic for large roads or cities. For large <code>zoom</code> levels, we can detect traffic on specific roads, but can only capture traffic for a smaller area. We could set a large <code>zoom</code> and a large <code>height</code> and <code>width</code>, but Google traffic information will fail to render if we set the <code>height</code> and <code>width</code> values too large.</p>
<p><strong>The package provides functions that allow querying granular traffic information for large spatial extents.</strong> Here, we make multiple queries to obtain traffic information for multiple areas, then the information is merged together into one raster file. The <code><a href="reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> and <code><a href="reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code> provide two different approaches for querying granular traffic information for spatial extents where multiple Google API queries are needed.</p>
<div class="section level3">
<h3 id="raster-from-polygon-">Raster from Polygon <a name="raster-from-polygon"></a>
<a class="anchor" aria-label="anchor" href="#raster-from-polygon-"></a>
</h3>
<p>The above example showed querying traffic information for lower Manhattan. Here, we show querying traffic information for all of Manhattan while still using a relatively high zoom level (that allows capturing traffic on smaller streets). The <code><a href="reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> accepts a polygon as an input; if needed, multiple API queries are made to query traffic for the full polygon. We still specify the <code>height</code> and <code>width</code>, which determines the height and width used for a single API query. Large <code>height</code> and <code>width</code> values will result in fewer Google queries, while smaller <code>height</code> and <code>width</code> values will require more queries to cover the same spatial area.</p>
<p>In the below example, we use a <code>height</code> and <code>width</code> of 2000 and a <code>zoom</code> of 16, which results in needing to make 14 Google API queries to cover all of Manhattan.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Grab polygon of Manhattan</span></span>
<span><span class="va">us_sp</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span><span class="st">'GADM'</span>, country<span class="op">=</span><span class="st">'USA'</span>, level<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ny_sp</span> <span class="op">&lt;-</span> <span class="va">us_sp</span><span class="op">[</span><span class="va">us_sp</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"New York"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon</a></span><span class="op">(</span>polygon    <span class="op">=</span> <span class="va">ny_sp</span>,</span>
<span>                                 height     <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                 width      <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                 zoom       <span class="op">=</span> <span class="fl">16</span>,</span>
<span>                                 google_key <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot raster</span></span>
<span><span class="va">r_df</span> <span class="op">&lt;-</span> <span class="fu">rasterToPoints</span><span class="op">(</span><span class="va">r</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Traffic\nLevel"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green2"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"#660000"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/nyc_large.jpg" alt="Example" width="500"></p>
</div>
<div class="section level3">
<h3 id="raster-from-grid-">Raster from Grid <a name="raster-from-grid"></a>
<a class="anchor" aria-label="anchor" href="#raster-from-grid-"></a>
</h3>
<p><code><a href="reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> creates a grid that covers a polygon, creates a traffic raster for each grid, and merges the rasters together. Some may prefer to first create and see the grid, then create a traffic raster using this grid. For example, one could (1) create a grid that covers a polygon then (2) remove certain grid tiles that cover areas that may not be of interest. The <code><a href="reference/gt_make_grid.html">gt_make_grid()</a></code> and <code><a href="reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code> functions facilitate this process; <code><a href="reference/gt_make_grid.html">gt_make_grid()</a></code> creates a grid, then <code><a href="reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code> uses a grid as an input to create a traffic raster.</p>
<p>First, we create a grid using <code><a href="reference/gt_make_grid.html">gt_make_grid()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gt_make_grid.html">gt_make_grid</a></span><span class="op">(</span>polygon <span class="op">=</span> <span class="va">ny_sp</span>,</span>
<span>                        height  <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        width   <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                        zoom    <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_df</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/nyc_grid.jpg" alt="Example" width="500"></p>
<p>We notice that the tile in the bottom left corner just covers water and some land outside of Manhattan. To reduce the number of API queries we need to make, we can remove this tile.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_clean_df</span> <span class="op">&lt;-</span> <span class="va">grid_df</span><span class="op">[</span><span class="op">-</span><span class="fl">12</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_clean_df</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/nyc_grid_clean.jpg" alt="Example" width="500"></p>
<p>Second, we use the grid to make a traffic raster using <code><a href="reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make raster</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gt_make_raster_from_grid.html">gt_make_raster_from_grid</a></span><span class="op">(</span>grid_param_df <span class="op">=</span> <span class="va">grid_clean_df</span>,</span>
<span>                              google_key    <span class="op">=</span> <span class="va">google_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot raster</span></span>
<span><span class="va">r_df</span> <span class="op">&lt;-</span> <span class="fu">rasterToPoints</span><span class="op">(</span><span class="va">r</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Traffic\nLevel"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green2"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"#660000"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="images/nyc_large_from_grid.jpg" alt="Example" width="500"></p>
<p>Note that the above raster includes traffic in areas outside of Manhattan; the image is not masked to just the Manhattan polygon. This result can also be achieved when using the <code><a href="reference/gt_make_raster_from_polygon.html">gt_make_raster_from_polygon()</a></code> function by setting <code>mask_to_polygon</code> to <code>FALSE</code>.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>`use_mit_license()`</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing googletraffic</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert Marty <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Marty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
